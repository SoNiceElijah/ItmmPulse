(this.webpackJsonpitmmpulseapp=this.webpackJsonpitmmpulseapp||[]).push([[0],{21:function(e,t,a){},23:function(e,t,a){e.exports=a(47)},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){"use strict";a.r(t);var n,s=a(0),i=a.n(s),l=a(8),c=a.n(l),o=a(1),r=a(2),m=a(4),d=a(3),u=a(6),g=a(5),h=a(11),p=a(10),v=a(9),f=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={},a.state.itloginStyle="",a.state.itpasswordStyle="",a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"signIn",value:function(){var e=v.validate(document,["itlogin","itpassword"]);if(console.log(e),0===e.errors.length)p.post("/login",{username:e.itlogin,password:e.itpassword}).then((function(e){console.log("Success!"),console.log(e),document.cookie="token=".concat(e.data.token,"; expires=Tue, 19 Jan 2038 03:14:07 GMT"),window.location.reload(!0)})).catch((function(){document.getElementById("resInfo").innerHTML="\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d/\u043f\u0430\u0440\u043e\u043b\u044c"}));else for(var t=0;t<e.errors.length;++t)this.setState(Object(h.a)({},e.errors[t]+"Style","mistake"))}},{key:"reset",value:function(e){this.setState(Object(h.a)({},e.target.id+"Style",""))}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"back",id:"pjs"}),i.a.createElement("div",{className:"main",id:"main"},i.a.createElement("div",{className:"center"},i.a.createElement("div",{className:"middle"},i.a.createElement("div",{className:"box"},i.a.createElement("div",{className:"logo"},i.a.createElement("div",{className:"top"},"ITMM"),i.a.createElement("div",{className:"bot"},i.a.createElement("span",null,"PULSE"))),i.a.createElement("div",{className:"form"},i.a.createElement("input",{id:"itlogin",onChange:function(t){e.reset(t)},className:this.state.itloginStyle,type:"text",name:"itlogin",placeholder:"Login"}),i.a.createElement("input",{id:"itpassword",onChange:function(t){e.reset(t)},className:this.state.itpasswordStyle,type:"password",name:"itpassword",placeholder:"Password"}),i.a.createElement("div",{className:"reg-info red-color",id:"resInfo"}),i.a.createElement("div",{onClick:function(){return e.signIn()},className:"button submit",id:"sin"},"sign in"),i.a.createElement("div",{onClick:function(){e.props.toReg()},className:"button small",id:"cos"},"sign up")))))))}}]),t}(i.a.Component),E=(a(21),function(e){function t(e){return Object(o.a)(this,t),Object(m.a)(this,Object(d.a)(t).call(this,e))}return Object(g.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"back",id:"pjs"}),i.a.createElement("div",{className:"main",id:"main"},i.a.createElement("div",{className:"center"},i.a.createElement("div",{className:"middle"},i.a.createElement("div",{className:"box"},i.a.createElement("div",{className:"logo"},i.a.createElement("div",{className:"top"},"ITMM"),i.a.createElement("div",{className:"bot"},i.a.createElement("span",null,"PULSE"))))))))}}]),t}(i.a.Component)),y=a(10),b=a(9),k=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={class:{name:"",user:"",pw1:"",pw2:""},info:"green-color",msg:""},a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"register",value:function(){var e=this,t=b.validate(document,["name","login","pw1","pw2"]);if(0!==t.errors.length){for(var a={name:"",login:"",pw1:"",pw2:""},n=0;n<t.errors.length;++n)a[t.errors[n]]="mistake";this.setState({class:a})}else{var s=b.val(document,"pw1"),i=b.val(document,"pw2");if(console.log(s),s!=i){var l=this.state.class;l.pw1="mistake",l.pw2="mistake",this.setState({class:l})}else y.post("/register",{name:t.name,username:t.login,password:t.pw1}).then((function(){e.setState({info:"green-color",msg:"\u0423\u0441\u043f\u0435\u0448\u043d\u043e!"})})).catch((function(){e.setState({info:"red-color",msg:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a. \u0421\u043a\u043e\u0440\u0435\u0435 \u0432\u0441\u0435\u0433\u043e \u0442\u0430\u043a\u043e\u0435 \u0438\u043c\u044f \u0443\u0436\u0435 \u0437\u043d\u044f\u0442\u043e"})}))}}},{key:"noColor",value:function(e){var t=this.state.class;t[e.target.id]="",this.setState({class:t}),console.log(this.state)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"back",id:"pjs"}),i.a.createElement("div",{className:"main",id:"main"},i.a.createElement("div",{className:"fix-header"},i.a.createElement("a",{className:"small-logo",onClick:function(){e.props.toLogin()}},"ITMM",i.a.createElement("span",null,"PULSE"))),i.a.createElement("div",{className:"center big-width f-height"},i.a.createElement("div",{className:"middle"},i.a.createElement("div",{className:"box big-width text-center"},i.a.createElement("div",{className:"info-part"},i.a.createElement("h1",null,"Hello!"),i.a.createElement("p",null,"\u041f\u0440\u0438\u0432\u0435\u0442!",i.a.createElement("b",null,"\u0411\u043e\u043b\u044c\u0448\u043e\u0435")," ",i.a.createElement("i",null,"\u0441\u043f\u0430\u0441\u0438\u0431\u043e"),", \u0447\u0442\u043e \u043f\u0440\u0438\u043d\u0438\u043c\u0430\u0435\u0448\u044c \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 ",i.a.createElement("b",null,"EARLY-ALPHA")," \u0442\u0435\u0441\u0442\u0435 \u043d\u0430\u0448\u0435\u0433\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f. \u042d\u0442\u043e \u043e\u0434\u0438\u043d \u0438\u0437 \u0441\u0430\u043c\u044b\u0445 \u0440\u0430\u043d\u043d\u0438\u0445 \u0431\u0438\u043b\u0434\u043e\u0432, \u0438 \u043e\u043d \u043f\u043e\u043b\u043e\u043d \u043e\u0448\u0438\u0431\u043e\u043a. \u0414\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431 \u043e\u0442\u043b\u0430\u0434\u0438\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0438 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0443\u0434\u043e\u0431\u043d\u044b\u043c \u043d\u0430\u043c \u043d\u0443\u0436\u043d\u0430 ",i.a.createElement("i",null,"\u0442\u0432\u043e\u044f")," \u043f\u043e\u043c\u043e\u0449\u044c.")),i.a.createElement("div",{className:"form-part form"},i.a.createElement("input",{id:"name",onChange:function(t){return e.noColor(t)},className:this.state.class.name,type:"text",name:"itname",placeholder:"name"}),i.a.createElement("input",{id:"login",onChange:function(t){return e.noColor(t)},className:this.state.class.login,type:"text",name:"ituser",placeholder:"login"}),i.a.createElement("input",{id:"pw1",onChange:function(t){return e.noColor(t)},className:this.state.class.pw1,type:"password",name:"itpass1",placeholder:"password"}),i.a.createElement("input",{id:"pw2",onChange:function(t){return e.noColor(t)},className:this.state.class.pw2,type:"password",name:"itpass2",placeholder:"password again"}),i.a.createElement("div",{className:"reg-info "+this.state.info,id:"resInfo"},this.state.msg),i.a.createElement("div",{className:"button submit",onClick:function(){e.register()},id:"reg"},"sign up"),i.a.createElement("div",{className:"button small",onClick:function(){e.props.toLogin()}},"login page"))),i.a.createElement("div",{className:"fix-footer"})))))}}]),t}(i.a.Component),N=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={},a.state.modeStyle="ov-hidden",a.state.alertStyle="al-down",a.state.msg="",a.state.ok="",a.state.okAction=function(){},a.state.cancelAction=function(){},a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"dismiss",value:function(){this.setState({modeStyle:"ov-hidden",alertStyle:"al-down"}),this.state.cancelAction()}},{key:"rise",value:function(e){this.setState({msg:e.msg,ok:e.ok,okAction:e.okAction,cancelAction:e.cancelAction,modeStyle:"",alertStyle:""})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"up-overlay "+this.state.modeStyle,id:"overlay"},i.a.createElement("div",{className:"overlay-back",onClick:function(){e.dismiss()}}),i.a.createElement("div",{className:"alert "+this.state.alertStyle,id:"alert"},i.a.createElement("div",{className:"alert-content",id:"acontent"},this.state.msg),i.a.createElement("div",{className:"alert-buttons"},i.a.createElement("div",{className:"button small",onClick:function(){e.dismiss()},id:"acancel"},"\u043d\u0430\u0437\u0430\u0434"),i.a.createElement("div",{className:"button submit",onClick:function(){e.state.okAction()},id:"aok"},this.state.ok))))}}]),t}(i.a.Component),C=function(e){function t(e){return Object(o.a)(this,t),Object(m.a)(this,Object(d.a)(t).call(this,e))}return Object(g.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"big flex-center standart-back"},i.a.createElement("div",{className:"box"},i.a.createElement("div",{className:"excuse-logo"}),i.a.createElement("div",{className:"excuse-msg"}," \u0414\u0430\u043d\u043d\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0432 ",i.a.createElement("i",null,"\u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0439")," \u0441\u0442\u0430\u0434\u0438\u0438 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u043d\u0430 \u043f\u043e\u043a\u0430 \u0447\u0442\u043e ",i.a.createElement("b",null,"\u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 :( "))))}}]),t}(i.a.Component),j=a(22),O=a(9),w=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={},a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=document.getElementById("mid"+this.props.data._id);setTimeout((function(){e.classList.remove("left-offset"),e.classList.remove("opacity-0")}),20)}},{key:"render",value:function(){var e=this.props.data,t=e.msg.match(/::(.*?);/g);if(t)for(var a=0;a<t.length;++a){var n="/emoji/svg/";n+=t[a].slice(2,t[a].length-1),e.msg=e.msg.replace(t[a],'<img class="emoji-small-text" src="'.concat(n,'" />'))}if(0==this.props.me){var s="message-item";return e.anim&&(s+=" left-offset easy-delay opacity-0"),i.a.createElement("div",{className:s,id:"mid"+e._id},i.a.createElement("div",{style:{background:e.color},className:"message-item-avatar"},e.from.toUpperCase()[0]),i.a.createElement("div",{className:"message-item-content"},i.a.createElement("div",{className:"message-item-owner"},e.from),i.a.createElement("div",{className:"message-item-msg",dangerouslySetInnerHTML:{__html:e.msg}}),i.a.createElement("div",{className:"message-item-date"},O.time(e.date))))}var l="message-item msg-me";return e.anim&&(l+=" left-offset easy-delay opacity-0"),i.a.createElement("div",{className:l,id:"mid"+e._id},i.a.createElement("div",{className:"me-avatar-fix"},i.a.createElement("div",{style:{background:e.color},className:"message-item-avatar"},e.from.toUpperCase()[0])),i.a.createElement("div",{className:"message-item-content"},i.a.createElement("div",{className:"message-item-owner"},e.from),i.a.createElement("div",{className:"message-item-msg",dangerouslySetInnerHTML:{__html:e.msg}}),i.a.createElement("div",{className:"message-item-date"},O.time(e.date))))}}]),t}(i.a.Component),L=a(10),T=a(9),S=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={},a.state.messages=[],a.state.clicks=0,a.componentDidUpdate=a.componentDidUpdate.bind(Object(u.a)(a)),a.getHistory=a.getHistory.bind(Object(u.a)(a)),a.messageArray=a.messageArray.bind(Object(u.a)(a)),a.state.rescroll=!0,a.state.full=!0,a.state.topdiff=0,a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"notSelected",value:function(){return i.a.createElement("div",{className:"no-selected-chat"}," \u0427\u0442\u043e\u0431 ",i.a.createElement("b",null,"\u043d\u0430\u0447\u0430\u0442\u044c")," \u0432\u044b\u0431\u0435\u0440\u0438 \u0447\u0430\u0442 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 ",i.a.createElement("i",null,"\u0441\u043b\u0435\u0432\u0430"))}},{key:"noMessages",value:function(){return i.a.createElement("div",{className:"no-messages"},i.a.createElement("div",{className:"no-messages-logo"}),i.a.createElement("div",{className:"no-messages-content"},"\u041a\u0430\u0436\u0435\u0442\u0441\u044f \u0442\u0443\u0442 \u0435\u0449\u0435 ",i.a.createElement("b",null,"\u043d\u0435\u0442")," \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u041d\u0430\u043f\u0438\u0448\u0438 ",i.a.createElement("i",null,"\u043f\u0435\u0440\u0432\u043e\u0435"),"!"))}},{key:"aLotOfMessages",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{id:"messageLoader",className:"message-panel-loader"},i.a.createElement("div",{className:"loader"})),i.a.createElement("div",{className:"message-panel",onScroll:function(t){e.scrollHandler(t)},id:"messagePanel2"},i.a.createElement("div",{className:"message-top-loading",id:"historyLoader"},i.a.createElement("div",{className:"loader"})),i.a.createElement("div",{className:"message-list"},this.messageArray(this.state.messages))))}},{key:"messageArray",value:function(e){if(0!=e.length){var t=T.timeDate(e[0].date),a=[];a.push(this.dateStringComponent(t));for(var n=t,s=0;s<e.length;++s)(t=T.timeDate(e[s].date))!=n&&a.push(this.dateStringComponent(t)),a.push(this.message(e[s])),n=t;return a}}},{key:"dateStringComponent",value:function(e){return i.a.createElement("div",{key:e,className:"message-date-string relative"},i.a.createElement("div",{className:"message-line "}),i.a.createElement("div",{className:"message-date-string-content"},e))}},{key:"message",value:function(e){var t=this.props.findUser(e.uid);return e.from=t.name,e.color=t.color,e.uid!==this.props.me._id?i.a.createElement(w,{data:e,me:!1,key:e._id}):i.a.createElement(w,{data:e,me:!0,key:e._id})}},{key:"componentDidUpdate",value:function(e){if(e.id!=this.props.id&&this.props.exists){var t=document.getElementById("messageLoader");t.classList.remove("opacity-0"),t.classList.remove("display-none"),setTimeout((function(){t.classList.add("delay")}),10),this.state.clicks++,this.state.full=!0,this.state.messages=[],this.getHistory(!0),this.state.rescroll=!0}else if(e.newMsg!=this.props.newMsg){var a=this.state.messages,n=this.props.newMsg.map((function(e){return Object(j.a)({},e,{anim:!0})})),s=(a=a.concat(n)).map((function(e){return e._id}));a=a.filter((function(e,t){return s.indexOf(e._id)===t})),this.state.rescroll=!0,this.setState({messages:a})}else{console.log("RESIZE?");var i=document.getElementById("messagePanel2");i&&(this.state.rescroll?i.scrollTop=i.scrollHeight:i.scrollTop=i.scrollHeight-this.state.topdiff)}}},{key:"componentWillUnmount",value:function(){console.log("Message panel unmount")}},{key:"getHistory",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];document.getElementById("historyLoader").classList.remove("opacity-0"),L.post("/api/message/history",{id:this.props.id,limit:20,skip:this.state.messages.length}).then((function(a){var n=document.getElementById("messageLoader"),s=document.getElementById("messagePanel2");s&&(e.state.rescroll=s.scrollHeight-s.scrollTop===s.clientHeight),a.data.reverse();var i=e.state.messages,l=(i=a.data.concat(i)).map((function(e){return e._id}));i=i.filter((function(e,t){return l.indexOf(e._id)===t})),a.data.length<20?(document.getElementById("historyLoader").classList.add("opacity-0"),e.state.full=!0):e.state.full=!1,s&&(e.state.topdiff=s.scrollHeight-s.scrollTop),console.log(e.state.messages.length),e.setState({messages:i}),t&&(e.state.clicks--,0===e.state.clicks&&(n.classList.add("opacity-0"),setTimeout((function(){0===e.state.clicks&&(n.classList.add("display-none"),n.classList.remove("delay"))}),200)))})).catch((function(e){console.log("WTF"),console.log(e)}))}},{key:"scrollHandler",value:function(e){0!=e.target.scrollTop||this.state.full||(console.log("GOT HISTORY"),this.getHistory())}},{key:"render",value:function(){return""===this.props.id?this.notSelected():this.props.exists?this.aLotOfMessages():this.noMessages()}}]),t}(i.a.Component),M=(a(45),a(10)),I=a(9),B=M.CancelToken,x=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={},a.state.chats={},a.state.chats.chats=[],a.state.chats.members=[],a.state.currentChat="",a.state.currentExist="",a.state.msgs=[],a.state.emoji=[],a.state.longpoll=!0,a.longPoll=a.longPoll.bind(Object(u.a)(a)),a.openChat=a.openChat.bind(Object(u.a)(a)),a.notifications=a.notifications.bind(Object(u.a)(a)),a.findUserByid=a.findUserByid.bind(Object(u.a)(a)),a.findChatByid=a.findChatByid.bind(Object(u.a)(a)),a.state.msgInterval=null,a.state.connection=null,a.state.write=!1,a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"findUserByid",value:function(e){var t=this.state.chats.members.find((function(t){return t._id===e}));return t||this.componentDidMount(!1),t}},{key:"findChatByid",value:function(e){var t=this.state.chats.chats.find((function(t){return t._id===e}));return t||this.componentDidMount(!1),t}},{key:"componentDidMount",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];M.post("/api/message/emoji").then((function(t){e.state.emoji=t.data})),M.post("/api/user/me").then((function(t){e.state.me=t.data,M.post("/api/team/info",{id:e.state.me.team_ids[0]}).then((function(t){e.setState({chats:t.data}),console.log(e.state);var a=document.getElementById("chatLoader");a.classList.add("opacity-0"),setTimeout((function(){a.classList.add("display-none")}),200)})).catch((function(e){console.log("WTF"),console.log(e)}))})).catch((function(e){console.log("WTF"),console.log(e)})),t&&(console.log("Open longpoll"),this.longPoll(I.toUTC(new Date)))}},{key:"littleChat",value:function(e){var t=this;return i.a.createElement("div",{onClick:function(a){t.openChat(e._id)},key:"key"+e._id,className:"chat-list-item",id:"cid"+e._id},i.a.createElement("strong",null,"#"),i.a.createElement("span",null,e.name),i.a.createElement("div",{id:"cidal"+e._id,className:"new-message-alert template"},"0"))}},{key:"littleMember",value:function(e){var t=this;return e.me?i.a.createElement("div",{key:"key"+e._id,className:"member-list-item",title:"\u042d\u0442\u043e \u0436\u0435 \u044f!",me:"me"},i.a.createElement("strong",{id:"me"},"@"),i.a.createElement("span",{id:"me"},e.name)):e.exist?i.a.createElement("div",{onClick:function(a){t.openChat(e.direct)},key:"key"+e._id,id:"cid"+e.direct,exist:"exist",className:"member-list-item"},i.a.createElement("strong",null,"@"),i.a.createElement("span",null,e.name),i.a.createElement("div",{id:"cidal"+e.direct,className:"new-message-alert template"},"0")):i.a.createElement("div",{onClick:function(a){t.openChat(e._id,!1)},key:"key"+e._id,id:"cid"+e._id,className:"member-list-item"},i.a.createElement("strong",null,"@"),i.a.createElement("span",null,e.name),i.a.createElement("div",{id:"cidal"+e._id,className:"new-message-alert template"},"0"))}},{key:"openChat",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.state.currentChat!=e){var a=document.getElementById("cidal"+e);"0"!=a.innerHTML&&(window.clearInterval(this.state.msgInterval),document.title="Pulse",a.innerHTML="0",a.classList.add("template")),""!=this.state.currentChat&&document.getElementById("cid"+this.state.currentChat).removeAttribute("selected"),document.getElementById("cid"+e).setAttribute("selected","selected"),this.setState({currentChat:e,currentExist:t})}}},{key:"send",value:function(){var e=this;if(console.log("try send"),""!=this.state.currentChat){var t=document.getElementById("msg"),a=document.getElementById("fake_msg");if(t){var n=t.value;if(!I.isEmptyOrSpaces(n)){var s={};s.msg=n,s.cid=this.state.currentChat,s.random=Math.floor(1e3*Math.random()),t.value="",a.innerHTML="",this.state.currentExist?(M.post("/api/chat/writing",{id:s.cid,state:!1}),this.state.write=!1,M.post("/api/message/send",s).then((function(e){})).catch((function(e){console.log("WTF"),console.log(e)}))):M.post("/api/message/whisper",s).then((function(n){t.value="",a.innerHTML="",e.componentDidMount(!1),e.setState({currentChat:n.data.id,currentExist:!0})})).catch((function(e){console.log("WTF"),console.log(e)}))}}}}},{key:"componentWillUnmount",value:function(){this.state.longpoll=!1,n&&n(),console.log("unmount")}},{key:"longPoll",value:function(e){var t=this;console.log("LongPollCalled with TS: ".concat(e)),M.post("/api/message/updates",{ts:e},{cancelToken:new B((function(e){n=e}))}).then((function(a){console.log("LONG_POLL_DATA:"),console.log(a.data);var n=a.data.find((function(e){return"msg"==e.type})),s=a.data.find((function(e){return"write"==e.type})),i=a.data.find((function(e){return"new"==e.type}));if(t.state.longpoll)if(1==a.data.length&&"restart"==a.data[0].type)console.log("LongPollRestarted"),t.longPoll(e);else{console.log("LongPollUpdated");var l=a.data.map((function(e){return e.ts}));t.longPoll(Math.max.apply(Math,l))}if(n&&(t.setState({msgs:n.content.filter((function(e){return e.cid==t.state.currentChat}))}),t.notifications(n)),s){var c=s.content.filter((function(e){return e.cid==t.state.currentChat})).map((function(e){return e.members}));c=c[c.length-1],t.changeWriters(c)}i&&t.componentDidMount(!1)})).catch((function(e){console.log("longPollError"),console.log(e)}))}},{key:"changeWriters",value:function(e){var t=this;e=(e=e.filter((function(e){return e!=t.state.me._id}))).map((function(e){return t.findUserByid(e)})).map((function(e){return e.name}));var a=document.getElementById("writers");if(0==e.length)a.classList.add("opacity-0");else{var n=e.join(", ");n.length>15&&(n=n.slice(0,15)+"..."),this.setState({writers:n}),a.classList.remove("opacity-0")}}},{key:"notifications",value:function(e){var t=this;try{e.content.map((function(e){return e.cid})).map((function(e){return t.findChatByid(e)}));console.log("Do Notifications!");for(var a={},n=0;n<e.content.length;++n)e.content[n].cid!=this.state.currentChat&&(a["cidal"+e.content[n].cid]?a["cidal"+e.content[n].cid]++:a["cidal"+e.content[n].cid]=1);var s=0;for(var i in a){var l=document.getElementById(i).innerHTML;document.getElementById(i).innerHTML=parseInt(l)+a[i],document.getElementById(i).classList.remove("template"),s++}if(0!=s){new Audio("/effects/click.mp3").play();var c=-1,o=["NEW","MESSAGE"];clearInterval(this.state.msgInterval);var r=setInterval((function(){c++,c%=2,document.title=o[c]}),1e3);this.setState({msgInterval:r})}}catch(m){console.log(m)}}},{key:"chatPanel",value:function(){var e=this;return i.a.createElement("div",{className:"chat-panel"},i.a.createElement("div",{className:"chat-list"},i.a.createElement("div",{className:"chat-list-title"},"Chats"),i.a.createElement("div",{className:"chat-list-items"},this.state.chats.chats.map((function(t){return e.littleChat(t)})))),i.a.createElement("div",{className:"member-list"},i.a.createElement("div",{className:"member-list-title"},"Members"),i.a.createElement("div",{className:"member-list-items"},this.state.chats.members.map((function(t){return e.littleMember(t)})))))}},{key:"textChangeMonitor",value:function(e){var t=document.getElementById("msg"),a=e.target.innerText;a=(a=a.replace(/<br>/gi," ")).replace(/&nbsp;/g," "),t.value=a,""!=this.state.currentChat&&this.state.currentExist&&(this.state.write||I.isEmptyOrSpaces(t.value)?I.isEmptyOrSpaces(t.value)&&(console.log("StopWrite"),M.post("/api/chat/writing",{id:this.state.currentChat,state:!1}),this.state.write=!1):(console.log("STARTWrite"),M.post("/api/chat/writing",{id:this.state.currentChat,state:!0}),this.state.write=!0))}},{key:"focuseGotMonitor",value:function(e){if(""!=this.state.currentChat&&this.state.currentExist){var t=document.getElementById("msg");I.isEmptyOrSpaces(t.value)||(console.log("STARTWrite"),M.post("/api/chat/writing",{id:this.state.currentChat,state:!0}),this.state.write=!0)}}},{key:"focuseLostMonitor",value:function(e){""!=this.state.currentChat&&this.state.currentExist&&this.state.write&&(console.log("StopWrite"),M.post("/api/chat/writing",{id:this.state.currentChat,state:!1}),this.state.write=!1)}},{key:"mapEmoji",value:function(e){var t=this,a="/emoji/svg/"+e;return i.a.createElement("img",{className:"emoji-small",onClick:function(){t.pushEmoji(e)},src:a})}},{key:"pushEmoji",value:function(e){var t="/emoji/svg/"+e;document.getElementById("fake_msg").innerHTML+='<span class="fake-text">::'.concat(e,';</span><img class="emoji-small-text" src="').concat(t,'" ></img>')}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"big standart-back relative"},i.a.createElement("div",{className:"chat-panel-loader delay",id:"chatLoader"},i.a.createElement("div",{className:"loader"})),this.chatPanel(),i.a.createElement("div",{className:"right-box relative"},i.a.createElement("div",{className:"message-panel-big",id:"messagePanel"},i.a.createElement(S,{newMsg:this.state.msgs,me:this.state.me,findUser:this.findUserByid,id:this.state.currentChat,exists:this.state.currentExist}),i.a.createElement("div",{id:"writers",className:"message-panel-writers delay opacity-0"},i.a.createElement("b",null,this.state.writers)," \u043d\u0430\u0431\u0438\u0440\u0430\u0435\u0442 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435... ")),i.a.createElement("div",{className:"send-panel"},i.a.createElement("div",{className:"send-input relative"},i.a.createElement("input",{id:"msg",type:"text",autoComplete:"off",name:"msgbox",placeholder:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435..."}),i.a.createElement("div",{"data-text":"Enter text here",onInput:function(t){return e.textChangeMonitor(t)},onFocus:function(t){return e.focuseGotMonitor(t)},onKeyUp:function(t){"Enter"==t.key&&e.send()},onBlur:function(t){return e.focuseLostMonitor(t)},className:"send-input-div",contentEditable:"true",id:"fake_msg",type:"text",autoComplete:"off"}),i.a.createElement("div",{className:"emoji-button",id:"emojiButton"},i.a.createElement("div",{className:"emoji-image"}),i.a.createElement("div",{id:"emojiPanel",className:"emoji-panel delay t-delay"},this.state.emoji.map((function(t){return e.mapEmoji(t)})))),i.a.createElement("div",{onClick:function(t){e.textChangeMonitor({target:document.getElementById("fake_msg")}),e.send()},className:"send-button",id:"send"},i.a.createElement("div",{className:"send-image"})),i.a.createElement("div",{className:"attach-button",id:"attach"},i.a.createElement("div",{className:"attach-image"}),i.a.createElement("div",{className:"attach-panel delay t-delay"},i.a.createElement("ul",null,i.a.createElement("li",null,"Post"),i.a.createElement("li",null,"DickPic"))))))))}}]),t}(i.a.Component),P=(a(46),a(10)),A=a(9),_=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={},a.state.currentPage=null,a.state.currentButton="",a.pages={},a.pages.mp=i.a.createElement(C,null),a.pages.np=i.a.createElement(C,null),a.pages.tp=i.a.createElement(C,null),a.pages.cp=i.a.createElement(x,null),a.hideAlert=a.hideAlert.bind(Object(u.a)(a)),a.overlay=i.a.createRef(),a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=A.getCookie("page");e&&this.menuButtonClicked({currentTarget:{id:e}})}},{key:"logOut",value:function(){P.post("/logout").then((function(){window.location.reload(!0)})).catch((function(e){console.log("WTF"),console.log(e)}))}},{key:"hideAlert",value:function(){}},{key:"riseLogOutAlert",value:function(){this.overlay.current.rise({msg:"\u0412\u044b\u0439\u0442\u0438?",ok:"\u0412\u044b\u0445\u043e\u0434",okAction:this.logOut,cancelAction:this.hideAlert})}},{key:"menuButtonClicked",value:function(e){var t=e.currentTarget.id;if(this.state.currentButton!=t){var a=document.getElementById("content");a.classList.add("central-panel-offset"),a.classList.add("central-panel-invis"),this.setState({currentPage:this.pages[t]}),setTimeout((function(){a.classList.add("central-panel-shadow"),a.classList.add("central-panel-transition"),a.classList.remove("central-panel-offset"),a.classList.remove("central-panel-invis")}),10),setTimeout((function(){a.classList.remove("central-panel-transition"),a.classList.remove("central-panel-shadow")}),340),document.getElementById(this.state.currentButton)&&document.getElementById(this.state.currentButton).removeAttribute("selected"),this.state.currentButton=t,document.cookie="page=".concat(t,"; expires=Tue, 19 Jan 2038 03:14:07 GMT"),document.getElementById(this.state.currentButton).setAttribute("selected","selected")}}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement(N,{ref:this.overlay}),i.a.createElement("div",{className:"back"}),i.a.createElement("div",{className:"main"},i.a.createElement("div",{className:"top-panel"}),i.a.createElement("div",{className:"left-panel"},i.a.createElement("div",{className:"left-panel-top"},i.a.createElement("div",{className:"mbutton",id:"mp",onClick:function(t){e.menuButtonClicked(t)},selected:"selected"},i.a.createElement("div",{className:"main-button"}," ")),i.a.createElement("div",{className:"mbutton",id:"np",onClick:function(t){e.menuButtonClicked(t)}},i.a.createElement("div",{className:"news-image"})),i.a.createElement("div",{className:"mbutton",id:"tp",onClick:function(t){e.menuButtonClicked(t)}},i.a.createElement("div",{className:"table-image"})),i.a.createElement("div",{className:"mbutton",id:"cp",onClick:function(t){e.menuButtonClicked(t)}},i.a.createElement("div",{className:"chat-image"}))),i.a.createElement("div",{className:"left-panel-bottom"},i.a.createElement("div",{onClick:function(t){e.riseLogOutAlert()},className:"mbutton",id:"logout"},i.a.createElement("div",{className:"logout-image"})))),i.a.createElement("div",{className:"central-panel",id:"content"},this.state.currentPage)))}}]),t}(i.a.Component),H=a(10),D=a(9),U=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this,e))).state={current:i.a.createElement(E,null)},a.goToLogin=a.goToLogin.bind(Object(u.a)(a)),a.goToPage=a.goToPage.bind(Object(u.a)(a)),a.goToRegister=a.goToRegister.bind(Object(u.a)(a)),a}return Object(g.a)(t,e),Object(r.a)(t,[{key:"amISignedIn",value:function(){var e=this,t=D.getCookie("token");D.isEmptyOrSpaces(t)?this.goToLogin():H.post("/api/message/test").then((function(t){console.log(t),"MESSAGE"===t.data&&e.goToPage()})).catch((function(t){e.goToLogin()}))}},{key:"goToLogin",value:function(){var e=this.state;e.current=i.a.createElement(f,{toReg:this.goToRegister,toPage:this.goToPage}),this.setState(e)}},{key:"goToRegister",value:function(){var e=this.state;e.current=i.a.createElement(k,{toLogin:this.goToLogin}),this.setState(e)}},{key:"goToPage",value:function(){var e=this.state;e.current=i.a.createElement(_,null),this.setState(e)}},{key:"componentDidMount",value:function(){this.amISignedIn()}},{key:"render",value:function(){return i.a.createElement("div",null,this.state.current)}}]),t}(i.a.Component);c.a.render(i.a.createElement(U,null),document.getElementById("root"))},9:function(e,t){function a(e){return void 0===e||null===e||null!==e.match(/^ *$/)}e.exports={getCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},isEmptyOrSpaces:a,validate:function(e,t){for(var n={errors:[]},s=0;s<t.length;++s){var i=e.getElementById(t[s]).value;a(i)?n.errors.push(t[s]):n[t[s]]=i}return n},val:function(e,t){return e.getElementById(t).value},time:function(e){var t=new Date(e-60*(new Date).getTimezoneOffset()*1e3),a=t.getHours(),n=t.getMinutes();return Math.floor(a/10)+""+Math.floor(a%10)+":"+(Math.floor(n/10)+""+Math.floor(n%10))},toUTC:function(e){return e.getTime()+60*e.getTimezoneOffset()*1e3},timeDate:function(e){var t=new Date(e-60*(new Date).getTimezoneOffset()*1e3),a=t.getDay(),n=t.getMonth(),s=t.getFullYear();return Math.floor(a/10)+""+Math.floor(a%10)+"."+(Math.floor(n/10)+""+Math.floor(n%10))+"."+s}}}},[[23,1,2]]]);
//# sourceMappingURL=main.b7288a08.chunk.js.map